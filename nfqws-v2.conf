#!/bin/bash

###############################################################################
# NFQWS Configuration v2.0 - WARP Only
# For Keenetic routers with Entware
###############################################################################

# Provider network interface (typically ppp0 for WARP)
ISP_INTERFACE="ppp0"

# ========================================
# WARP UDP 443 Obfuscation Strategy
# ========================================
# Fake+split2: 
#   - Sends fake QUIC packet to confuse DPI
#   - Then splits 2nd packet into 2 parts
# repeats=4: Send 4 desync packets
# ttl=3: Low TTL to avoid early DPI detection
# badsum: Wrong checksum to bypass pattern matching
NFQWS_ARGS="--filter-udp=443 --dpi-desync=fake,split2 --dpi-desync-repeats=4 --dpi-desync-ttl=3 --dpi-desync-fooling=badsum"

# ========================================
# NO EXTRA STRATEGIES (WARP-ONLY MODE)
# ========================================
# These are empty because we focus ONLY on WARP handshake
# Remove Discord, STUN, QUIC strategies - they're not needed
NFQWS_ARGS_QUIC=""
NFQWS_ARGS_UDP=""

# Apply rules to domains in user.list
# Leave user.list empty for automatic WARP-only mode
NFQWS_EXTRA_ARGS="--hostlist=/opt/etc/nfqws/user.list"

# No IP-set rules needed for WARP
NFQWS_ARGS_IPSET=""

# No custom arguments
NFQWS_ARGS_CUSTOM=""

# ========================================
# BASE CONFIGURATION
# ========================================
IPV6_ENABLED=0
TCP_PORTS="443"
UDP_PORTS="443"
POLICY_NAME="nfqws"
POLICY_EXCLUDE=0
LOG_LEVEL=0
NFQUEUE_NUM=200
USER="nobody"
CONFIG_VERSION=8

# ========================================
# DOCUMENTATION
# ========================================
# For detailed NFQWS arguments, see:
# https://github.com/bol-van/zapret
#
# Common DPI-desync methods:
# - fake: Send fake QUIC packet to confuse DPI
# - split2: Split handshake into 2 parts
# - split3: Split handshake into 3 parts
#
# Profile recommendations:
# WEAK:       --dpi-desync=fake --dpi-desync-repeats=4 --dpi-desync-ttl=5
# MEDIUM:     --dpi-desync=fake,split2 --dpi-desync-repeats=4 --dpi-desync-ttl=3
# AGGRESSIVE: --dpi-desync=fake,split3 --dpi-desync-repeats=6 --dpi-desync-ttl=2
#
# To modify:
# 1. Edit NFQWS_ARGS parameter above
# 2. Save file
# 3. Restart: /opt/etc/init.d/S51nfqws restart
# 4. Check logs: tail -f /opt/var/log/nfqws.log
